<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>ML Production</title>

    <meta name="description" content="A framework for easily creating beautiful presentations using HTML">
    <meta name="author" content="Hakim El Hattab">

    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>

    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

          <link rel="stylesheet" href="reveal.js/css/reveal.css">
          <!--<link rel="stylesheet" href="reveal.js/css/theme/white.css" id="theme">-->
          <!--<link rel="stylesheet" href="reveal.js/css/theme/black.css" id="theme">-->
          <!--<link rel="stylesheet" href="reveal.js/css/theme/night.css" id="theme">-->
          <!--<link rel="stylesheet" href="reveal.js/css/theme/simple.css" id="theme">-->
          <link rel="stylesheet" href="reveal.js/css/theme/solarized.css" id="theme">
      
          <!-- Code syntax highlighting -->
          <link rel="stylesheet" href="reveal.js/lib/css/zenburn.css">
          <style>
              /*pre code {*/
                  /*display: block;*/
                  /*padding: 0.5em;*/
                  /*background: #FFFFFF !important;*/
                  /*color: #000000 !important;*/
              /*}*/
      
              .right-img {
                  margin-left: 10px !important;
                  float: right;
                  height: 500px;
              }
              .todo:before {
                  content: 'TODO: ';
              }
              .todo {
                  color: red !important;
              }
              code span.line-number {
                  color: lightcoral;
              }
              .reveal pre code {
                  max-height: 1000px !important;
              }
      
              img {
                  border: 0 !important;
                  box-shadow:0 0 0 0 !important;
              }
      
              .reveal {
                  -ms-touch-action: auto !important;
                  touch-action: auto !important;
                      }
      
                      .reveal h2,
                      .reveal h3,
                      .reveal h4 {
                          letter-spacing: 2px;
                          font-family: 'Amiri', serif;
                          /* font-family: 'Times New Roman', Times, serif; */
                          font-weight: bold;
                          font-style: italic;
                          letter-spacing: -2px;
                          text-transform: none !important;
                      }
      
                      .reveal em {
                          font-weight: bold;
                      }
      
                      .reveal .step-subtitle h1 {
                          letter-spacing: 1px;
                      }
                      .reveal .step-subtitle h2,
                      .reveal .step-subtitle h3 {
                          text-transform: none;
                          font-style: italic;
                          font-weight: normal;
                          /* font-weight: 400; */
                          /* font-family: 'Amiri', serif; */
                          font-family: 'Lobster', serif;
                          letter-spacing: 1px;
                          color: #2aa198;
                          text-decoration: underline;
                      }
      
                      .reveal .front-page h1,
                      .reveal .front-page h2 {
                          font-family: "League Gothic";
                          font-style: normal;
                          text-transform: uppercase !important;
                          letter-spacing: 1px;
                      }
      
                      .reveal .front-page h1 {
                          font-size: 2.5em !important;
                      }
      
                      .reveal .highlight {
                          background-color: #D3337B;
                          color: white;
                      }
      
              .reveal section img {
                background: none;
              }
      
                      .reveal img.with-border {
                          border: 1px solid #586e75 !important;
                          box-shadow: 3px 3px 1px rgba(0, 0, 0, 0.15) !important;
                      }
      
                      .reveal li {
                          margin-bottom: 8px;
                      }
      
                      /* For li's that use FontAwesome icons as bullet-point */
                  .reveal ul.fa-ul li {
                      list-style-type: none;
                  }
          </style>
      
    <!-- Printing and PDF exports -->
    <script>
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        var printMode = window.location.search.match(/print-pdf/gi);
        link.href = printMode ? 'reveal.js/css/print/pdf.css' : 'reveal.js/css/print/paper.css';
        document.getElementsByTagName('head')[0].appendChild(link);
    </script>

    <!--[if lt IE 9]>
    <script src="reveal.js/lib/js/html5shiv.js"></script>
    <![endif]-->
</head>

<body>

<div class="reveal">
    <div class="slides">

            <section data-markdown class="preparation">
                    <textarea data-template>
### Preparation
* Rehearse Demos

                </textarea>
            </section>
<!-- 
Wie bringe ich ein Machine-Learning-Modell in Produktion?

Alles läuft bestens, du hast nach vielen Mühen und Experimenten ein ordentliches Machine-Learning-Modell erstellt. Doch was
jetzt? Wie bringt man so ein Modell nun in Produktion? Und was dann? Wie stellt man dann sicher, dass das Modell dort auch
den Job tut, den es soll? Und wie geht man mit neuen Daten um? Automatisch neu trainieren? Ist das überhaupt möglich? Wie
lange dauert das?

In diesem Vortrag beschäftigen wir uns mit diesen Fragen und betrachten dabei Sklearn, TensorFlow und eigene Implementierungen.
 -->
<section>
            <h2>Wie bringe ich ein Machine-Learning-Modell in Produktion?</h2>
            <p><a target="_blank" href="https://www.data2day.de/veranstaltung-7306-wie-bringe-ich-ein-machine-learning-modell-in-produktion.html">
                data2day, September 2018
            </a></p>
            <h4><a href="http://zeigermann.eu">Oliver Zeigermann</a> / <a href="http://twitter.com/djcordhose">@DJCordhose</a>
            </h4>
            <small>
            <a href="https://djcordhose.github.io/ai/2018_data2day_production.html">
                https://djcordhose.github.io/ai/2018_data2day_production.html</a>
            </small>
        </section>

        <section data-markdown class="todo">
                <textarea data-template>
- https://www.tensorflow.org/tfx/
  - https://www.tensorflow.org/tfx/transform/
  - https://www.tensorflow.org/tfx/model_analysis/
  - https://www.tensorflow.org/serving/
            </textarea>
        </section>

        <section data-markdown class="todo">
            <textarea data-template>
- Material from Evernote
        </textarea>
    </section>

    <section data-markdown>
            <textarea data-template>
## Two Parts

1. Technical
1. Process

Note:
- Process für den laberigen Teil
  - Google Test

</textarea>
            </section>


    
            <section data-markdown>
                    <textarea data-template>
## Parts One: Technical
                        </textarea>
                    </section>
        <section data-markdown>
                <textarea data-template>
### Deployment Scenarios

1. Flask Based Python Servers
   * Sklearn
   * Keras

1. Specialized TensorFlow Serving
    * TensorFlow Serving
    * Google Clound ML
    * tensorflow.js

1. Java Implementations
   * Custom Implementation
   * DeppLearn4J
            </textarea>
        </section>

        <section>
<h3>TensorFlow Serving REST Calls</h3>

<p>Starting the Model Server in Rest Mode</p>

<pre><code contenteditable data-trim>
tensorflow_model_server --rest_api_port=8501 \
--model_name=manning_insurance_1 \
--model_base_path=$(pwd)/tf
</code></pre>

<p>Curling to it</p>

<pre><code contenteditable data-trim class="python">
curl -X POST \
http://localhost:8501/v1/models/manning_insurance_1:predict  \
-d '{ "instances": [{"inputs": [ 100.0,  47.0,  10.0]}]}' 
# {
#     "predictions": [[0.0027608, 0.872088, 0.125151]
#     ]
# }</code></pre>

<p><small><a href='https://www.tensorflow.org/serving/api_rest'>https://www.tensorflow.org/serving/api_rest</a></small></p>

    </section>

        <section>
<h3>Deploying to the Browser</h3>

<p>Converting our Keras Model to TensorFlow.js</p>

<pre><code contenteditable data-trim>
tensorflowjs_converter --input_format keras \
./model/insurance.hdf5 \
./tfjs    
</code></pre>

<p>Loading and using directly from the Browser</p>

            <pre><code contenteditable data-trim class="fragment line-numbers javascript">
const model = await tf.loadModel('tfjs/model.json');
            </code></pre>
            <pre><code contenteditable data-trim class="fragment line-numbers javascript">
// max speed, age, thousand miles per year
const example = tf.tensor([[100, 47, 10]]);
const prediction = model.predict(example);
                    </code></pre>
            <pre><code contenteditable data-trim class="fragment line-numbers javascript">
console.log(await prediction.data());
//[0.00334801129065454, 0.8710343241691589, 0.12561771273612976]
    </code></pre>

<p><small><a href='https://js.tensorflow.org/tutorials/import-keras.html'>
    https://js.tensorflow.org/tutorials/import-keras.html</a>
<br>
            <a href='js/tensorflow-sandbox/load_manning_model.html' target="_blank">
                https://djcordhose.github.io/ai/js/tensorflow-sandbox/load_manning_model.html</a></small>
        </small></p>
        
    </section>



        <section data-markdown>
            <textarea data-template>
### Docker Container

* often the runtime environment is pretty complex and needs to scale
* at least we want something that has all the dependencies resolved and just works
* starting a Flask Server or TensorFlow serving is also nice
*  if we need a GPU installed on a server
   * https://github.com/NVIDIA/nvidia-docker
   * https://devblogs.nvidia.com/gpu-containers-runtime/
* but
  * only works with NVIDIA GPU
  * be careful, if your software requires a GPU make sure the server you run it on has a matching one
        </textarea>
    </section>

<section data-markdown class="todo">
        <textarea data-template>
### Wrapping Up
    
    </textarea>
    </section>
    
    </div>

</div>

<script src="reveal.js/lib/js/head.min.js"></script>
<script src="reveal.js/js/reveal.js"></script>
<script src="lib/jquery-2.2.4.js"></script>

<script>
        if (window.location.hostname.indexOf('localhost') !== -1 && !printMode) {
        } else {
            // only applies to public version
            $('.todo').remove();
            $('.preparation').remove();
            $('.local').remove();
        }
        Reveal.addEventListener( 'ready', function( event ) {
            if (window.location.hostname.indexOf('localhost') !== -1) {
                // only applies to presentation version
                Reveal.configure({ controls: false });
            } else {
                // only applies to public version
                $('.fragment').removeClass('fragment');
            }
            // applies to all versions
            $('code').addClass('line-numbers');
        } );
        // $('section').attr('data-background-image', "backgrounds/light-metal.jpg");
        // $('section').attr('data-background-image', "backgrounds/pink.jpg");
        // $('section').attr('data-background-image', "backgrounds/white.jpg");
        $('section').attr('data-background-image', "backgrounds/murmel2.jpg");
    //    $('section').attr('data-background-image', "backgrounds/code.jpg");
    </script>
    
<script>

    // Full list of configuration options available at:
    // https://github.com/hakimel/reveal.js#configuration
    Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,

        transition: 'fade', // none/fade/slide/convex/concave/zoom

        math: {
            mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
            config: 'TeX-AMS_HTML-full'  // See http://docs.mathjax.org/en/latest/config-files.html
        },

        // Optional reveal.js plugins
        dependencies: [
            {
                src: 'reveal.js/lib/js/classList.js', condition: function () {
                return !document.body.classList;
            }
            },
            {
                src: 'reveal.js/plugin/markdown/marked.js', condition: function () {
                return !!document.querySelector('[data-markdown]');
            }
            },
            {
                src: 'reveal.js/plugin/markdown/markdown.js', condition: function () {
                return !!document.querySelector('[data-markdown]');
            }
            },
            {
                src: 'reveal.js/plugin/highlight/highlight.js', async: true, condition: function () {
                return !!document.querySelector('pre code');
            }, callback: function () {
                hljs.initHighlightingOnLoad();
            }
            },
            {src: 'reveal.js/plugin/zoom-js/zoom.js', async: true},
            {src: 'reveal.js/plugin/notes/notes.js', async: true},
            // https://github.com/mikemiles86/reveal-line-numbers
            {src: 'lib/js/line-numbers.js'},
            { src: 'reveal.js/plugin/math/math.js', async: true }
        ]
    });

</script>

</body>
</html>
